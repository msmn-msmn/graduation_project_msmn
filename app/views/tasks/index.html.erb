<div class="container-fluid py-4">
  <!-- ヘッダー部分 -->
  <div class="row mb-4">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center">
      <h1 class="h2 text-dark mb-0">
        <i class="fas fa-tasks me-2"></i>タスクボード
      </h1>
      
      <!-- 右側のボタングループ -->
      <div class="d-flex align-items-center gap-3">
        <!-- ユーザー情報表示 -->
        <% if user_signed_in? %>
          <div class="d-flex align-items-center">
            <span class="text-muted me-3">
              <i class="fas fa-user-circle me-1"></i>
              <%= current_user.email %>
            </span>
            
            <!-- ログアウトボタン -->
            <%= button_to destroy_user_session_path, 
                method: :delete, 
                class: 'btn btn-outline-danger',
                data: { confirm: 'ログアウトしますか？' } do %>
              <i class="fas fa-sign-out-alt me-2"></i>ログアウト
            <% end %>
          </div>
        <% end %>
        
        <!-- 新しいタスク追加ボタン -->
        <%= link_to new_task_path, class: 'btn btn-primary btn-lg' do %>
          <i class="fas fa-plus me-2"></i>新しいタスクを追加
        <% end %>
      </div>
    </div>
  </div>
</div>

  <!-- 統計情報 -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body text-center">
          <h5 class="card-title">未着手</h5>
          <h2 class="mb-0"><%= @tasks.where(status: 'not_started').count %></h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-white">
        <div class="card-body text-center">
          <h5 class="card-title">進行中</h5>
          <h2 class="mb-0"><%= @tasks.where(status: 'in_progress').count %></h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white">
        <div class="card-body text-center">
          <h5 class="card-title">完了</h5>
          <h2 class="mb-0"><%= @tasks.where(status: 'completed').count %></h2>
        </div>
      </div>
    </div>
  </div>

  <!-- カンバンボード -->
  <div class="row">
    <!-- 未着手カラム -->
    <div class="col-lg-3 col-md-6 mb-4">
      <div class="kanban-column">
        <div class="kanban-header bg-info text-white">
          <h5 class="mb-0">
            <i class="fas fa-clipboard-list me-2"></i>未着手
            <span class="badge bg-light text-dark ms-2">
              <%= @tasks.where(status: 'not_started').count %>
            </span>
          </h5>
        </div>
        <div class="kanban-body" id="not_started-column">
          <% @tasks.where(status: 'not_started').order(:priority, :created_at).each do |task| %>
            <%= render 'task_card', task: task %>
          <% end %>
          
          <% if @tasks.where(status: 'not_started').empty? %>
            <div class="empty-state">
              <i class="fas fa-inbox text-muted mb-2"></i>
              <p class="text-muted mb-0">タスクがありません</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- 進行中カラム -->
    <div class="col-lg-3 col-md-6 mb-4">
      <div class="kanban-column">
        <div class="kanban-header bg-warning text-white">
          <h5 class="mb-0">
            <i class="fas fa-play-circle me-2"></i>進行中
            <span class="badge bg-light text-dark ms-2">
              <%= @tasks.where(status: 'in_progress').count %>
            </span>
          </h5>
        </div>
        <div class="kanban-body" id="in-progress-column">
          <% @tasks.where(status: 'in_progress').order(:priority, :created_at).each do |task| %>
            <%= render 'task_card', task: task %>
          <% end %>
          
          <% if @tasks.where(status: 'in_progress').empty? %>
            <div class="empty-state">
              <i class="fas fa-inbox text-muted mb-2"></i>
              <p class="text-muted mb-0">タスクがありません</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- 完了カラム -->
    <div class="col-lg-3 col-md-6 mb-4">
      <div class="kanban-column">
        <div class="kanban-header bg-success text-white">
          <h5 class="mb-0">
            <i class="fas fa-check-circle me-2"></i>完了
            <span class="badge bg-light text-dark ms-2">
              <%= @tasks.where(status: 'completed').count %>
            </span>
          </h5>
        </div>
        <div class="kanban-body" id="done-column">
          <% @tasks.where(status: 'completed').order(:completed_at).each do |task| %>
            <%= render 'task_card', task: task %>
          <% end %>
          
          <% if @tasks.where(status: 'completed').empty? %>
            <div class="empty-state">
              <i class="fas fa-inbox text-muted mb-2"></i>
              <p class="text-muted mb-0">タスクがありません</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- モーダル（タスク詳細表示用） -->
<div class="modal fade" id="taskModal" tabindex="-1" aria-labelledby="taskModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="taskModalLabel">タスク詳細</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="modal-content">
        <!-- Ajax で内容を読み込み -->
      </div>
    </div>
  </div>
</div>